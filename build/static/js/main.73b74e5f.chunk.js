(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{20:function(e,t,n){},24:function(e,t,n){e.exports=n(56)},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},55:function(e,t,n){},56:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),o=n(17),r=n.n(o),l=(n(29),n(6)),c=n(7),s=n(9),u=n(8),m=n(12),d=n(1),h=i.a.createContext({token:null,userId:null,login:function(e,t,n){},logout:function(){}}),f=(n(30),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={isLogin:!0},a.switchModeHandler=function(){a.setState((function(e){return{isLogin:!e.isLogin}}))},a.submitHandler=function(e){e.preventDefault();var t=a.emailEl.current.value,n=a.passwordEl.current.value;if(0!==t.trim().length&&0!==n.trim().length){var i={query:"\n        query Login($email: String!, $password: String!) {\n          login(email: $email, password: $password) {\n            userId\n            token\n            tokenExp\n          }\n        }\n      ",variables:{email:t,password:n}};a.state.isLogin||(i={query:"\n        mutation CreateUser($email: String!, $password: String!) {\n          createUser(userInput: {email: $email, password: $password}) {\n            _id\n            email\n          }\n        }\n      ",variables:{email:t,password:n}}),fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){e.data.login.token&&a.context.login(e.data.login.token,e.data.login.userId,e.data.login.tokenExp)})).catch((function(e){console.log(e)}))}},a.emailEl=i.a.createRef(),a.passwordEl=i.a.createRef(),a}return Object(c.a)(n,[{key:"render",value:function(){return i.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},i.a.createElement("h1",{className:"heading"},this.state.isLogin?"Login":"Sign Up"),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"email"},"E-mail"),i.a.createElement("input",{type:"email",id:"email",ref:this.emailEl})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"password"},"Password"),i.a.createElement("input",{type:"password",id:"password",ref:this.passwordEl})),i.a.createElement("div",{className:"form-actions"},i.a.createElement("button",{type:"submit"},"Submit"),i.a.createElement("button",{type:"button",onClick:this.switchModeHandler},"Switch to ",this.state.isLogin?"Sign Up":"Login")))}}]),n}(a.Component));f.contextType=h;var E=f,v=(n(31),function(e){return i.a.createElement("ul",{className:"bookings__list"},e.bookings.map((function(t){return i.a.createElement("li",{key:t._id,className:"bookings__item"},i.a.createElement("div",{className:"bookings__item-data"},t.event.title," -"," ",new Date(t.createdAt).toLocaleDateString()),i.a.createElement("div",{className:"bookings__item-actions"},i.a.createElement("button",{className:"btn",onClick:e.onDelete.bind(void 0,t._id)},"Cancel")))})))}),p=n(14),g=n(22),b={Cheap:{min:0,max:100},Normal:{min:101,max:999},Expensive:{min:1e3,max:1e6}},k=function(e){var t={labels:[],datasets:[]},n=[],a=function(a){var i=e.bookings.reduce((function(e,t){return t.event.price>b[a].min&&t.event.price<b[a].max?e+1:e}),0);n.push(i),t.labels.push(a),t.datasets.push({fillColor:"rgba(170, 170, 170, .5)",strokeColor:"rgba(170, 170, 170, .8)",highlightFill:"rgba(170, 170, 170, .75)",highlightStroke:"rgba(170, 170, 170, 1)",data:n}),(n=Object(p.a)(n))[n.length-1]=0};for(var o in b)a(o);return(i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(g.Bar,{data:t})))},y=(n(44),function(e){return i.a.createElement("div",{className:"bookings_control"},i.a.createElement("button",{className:"List"===e.activeOutput?"active":"",onClick:e.onChange.bind(void 0,"List")},"List"),i.a.createElement("button",{className:"Chart"===e.activeOutput?"active":"",onClick:e.onChange.bind(void 0,"Chart")},"Chart"))}),C=(n(20),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={isLoading:!1,bookings:[],outputType:"List"},e.fetchBookings=function(){e.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n        query {\n          bookings {\n            _id\n            createdAt\n            event {\n              _id\n              title\n              date\n              price\n            }\n          }\n        }\n      "}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(t){var n=t.data.bookings;e.setState({bookings:n,isLoading:!1})})).catch((function(e){console.log(e)}))},e.deleteBooking=function(t){e.setState({isLoading:!0});var n={query:"\n        mutation cancelBooking($id: ID!) {\n          cancelBooking(bookingId: $id) {\n            _id\n            title\n          }\n        }\n      ",variables:{id:t}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(n){e.setState((function(e){return{bookings:e.bookings.filter((function(e){return e._id!==t})),isLoading:!1}}))})).catch((function(e){console.log(e)}))},e.changeOutputType=function(t){"List"===t?e.setState({outputType:"List"}):e.setState({outputType:"Chart"})},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.fetchBookings()}},{key:"render",value:function(){var e=i.a.createElement("div",{className:"spinner"},i.a.createElement("div",{className:"lds-facebook"},i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null)));return this.state.isLoading||(e=i.a.createElement(i.a.Fragment,null,i.a.createElement(y,{activeOutput:this.state.outputType,onChange:this.changeOutputType}),i.a.createElement("div",null,"List"===this.state.outputType?i.a.createElement(v,{bookings:this.state.bookings,onDelete:this.deleteBooking}):i.a.createElement(k,{bookings:this.state.bookings})))),i.a.createElement(i.a.Fragment,null,e)}}]),n}(a.Component));C.contextType=h;var N=C,S=(n(45),function(e){return i.a.createElement("div",{className:"modal"},i.a.createElement("header",{className:"modal__header"},i.a.createElement("h1",null,e.title)),i.a.createElement("section",{className:"modal__content"},e.children),i.a.createElement("section",{className:"modal__actions"},e.onCancel&&i.a.createElement("button",{className:"btn",onClick:e.Cancel},"Cancel"),e.onConfirm&&i.a.createElement("button",{className:"btn",onClick:e.Confirm},e.confirmText)))}),w=(n(46),function(e){return i.a.createElement("div",{className:"backdrop"})}),L=(n(47),function(e){return i.a.createElement("li",{key:e.eventId,className:"events__list-item"},i.a.createElement("div",null,i.a.createElement("h1",null,e.title),i.a.createElement("h2",null,"$",e.price," - ",new Date(e.date).toLocaleDateString())),i.a.createElement("div",null,e.userId===e.creatorId?i.a.createElement("p",null,"Owner"):i.a.createElement("button",{className:"btn",onClick:e.details.bind(void 0,e.eventId)},"View Details")))}),_=(n(48),function(e){var t=e.events.map((function(t){return i.a.createElement(L,{key:t._id,eventId:t._id,title:t.title,price:t.price,date:t.date,userId:e.authUserId,creatorId:t.creator._id,details:e.viewDetail})}));return(i.a.createElement("ul",{className:"event__list"},t))}),O=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={creating:!1,events:[],isLoading:!1,selectedEvent:null},a.isActive=!0,a.createEvent=function(){a.setState({creating:!0})},a.confirmHandler=function(){a.setState({creating:!1});var e=a.titleELRef.current.value,t=+a.priceELRef.current.value,n=a.dateELRef.current.value,i=a.descriptionELRef.current.value;if(!(0===e.trim().length||0===i.trim().length||t<=0||0===n.trim().length)){var o={query:'\n        mutation {\n          createEvent(eventInput: {title: "'.concat(e,'", description: "').concat(i,'", price: ').concat(t,', date: "').concat(n,'"}) {\n            _id\n            title\n            description\n            date\n            price\n          }\n        }\n      ')},r=a.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json",Authorization:"Bearer "+r}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){a.setState((function(t){var n=Object(p.a)(t.events);return n.push({_id:e.data.createEvent._id,title:e.data.createEvent.title,description:e.data.createEvent.description,data:e.data.createEvent.date,price:e.data.createEvent.price,creator:{_id:a.context.userId}}),{events:n}}))})).catch((function(e){console.log(e)}))}},a.cancelHandler=function(){a.setState({creating:!1,selectedEvent:null})},a.showDetails=function(e){a.setState((function(t){var n=t.events.find((function(t){return t._id===e}));a.setState({selectedEvent:n})}))},a.bookEventHandler=function(){if(a.context.token){var e={query:'\n        mutation {\n          bookEvent(eventId: "'.concat(a.state.selectedEvent._id,'") {\n            _id\n            createdAt\n            updatedAt\n          }\n        }\n      ')};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){a.setState({selectedEvent:null})})).catch((function(e){console.log(e)}))}else a.setState({selectedEvent:null})},a.titleELRef=i.a.createRef(),a.priceELRef=i.a.createRef(),a.dateELRef=i.a.createRef(),a.descriptionELRef=i.a.createRef(),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"fetchEvents",value:function(){var e=this;this.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n        query {\n          events {\n            _id\n            title\n            description\n            date\n            price\n            creator {\n              _id \n              email\n            }\n          }\n        }\n      "}),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(t){var n=t.data.events;e.isActive&&e.setState({events:n,isLoading:!1})})).catch((function(t){console.log(t),e.isActive&&e.setState({isLoading:!1})}))}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,(this.state.creating||this.state.selectedEvent)&&i.a.createElement(w,null),this.state.creating&&i.a.createElement(S,{title:"Add Event",onCancel:!0,onConfirm:!0,Cancel:this.cancelHandler,Confirm:this.confirmHandler,confirmText:"Confirm"},i.a.createElement("form",null,i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"title"},"Title"),i.a.createElement("input",{type:"text",id:"title",ref:this.titleELRef})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"price"},"Price"),i.a.createElement("input",{type:"number",id:"price",ref:this.priceELRef})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"date"},"Date"),i.a.createElement("input",{type:"datetime-local",id:"date",ref:this.dateELRef})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"description"},"Description"),i.a.createElement("textarea",{id:"description",rows:"4",ref:this.descriptionELRef})))),this.state.selectedEvent&&i.a.createElement(S,{title:this.state.selectedEvent.title,onCancel:!0,onConfirm:!0,Cancel:this.cancelHandler,Confirm:this.bookEventHandler,confirmText:this.context.token?"Book":"Confirm"},i.a.createElement("h1",null,this.state.selectedEvent.title),i.a.createElement("h4",null,"$",this.state.selectedEvent.price," -"," ",new Date(this.state.selectedEvent.date).toLocaleDateString()),i.a.createElement("p",null,this.state.selectedEvent.description)),this.context.token&&i.a.createElement("div",{className:"events-control"},i.a.createElement("p",null,"Share your own Events!!"),i.a.createElement("button",{className:"btn",onClick:this.createEvent},"Create Event")),this.state.isLoading?i.a.createElement("div",{className:"spinner"},i.a.createElement("div",{className:"lds-facebook"},i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null))):i.a.createElement(_,{events:this.state.events,authUserId:this.context.userId,viewDetail:this.showDetails}))}}]),n}(a.Component);O.contextType=h;var x=O,j=(n(49),function(e){return i.a.createElement(h.Consumer,null,(function(e){return i.a.createElement("header",{className:"mainNavigation"},i.a.createElement("div",{className:"mainNavigation__logo"},i.a.createElement("h1",null,"Navlogo")),i.a.createElement("nav",{className:"mainNavigation__items"},i.a.createElement("ul",null,!e.token&&i.a.createElement("li",null,i.a.createElement(m.b,{to:"/auth"},"Authenticate")),i.a.createElement("li",null,i.a.createElement(m.b,{to:"/events"},"Events")),e.token&&i.a.createElement(i.a.Fragment,null,i.a.createElement("li",null,i.a.createElement(m.b,{to:"/bookings"},"Bookings")),i.a.createElement("li",null,i.a.createElement("button",{onClick:e.logout},"Logout"))))))}))}),T=(n(55),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={token:null,userId:null},e.login=function(t,n,a){e.setState({token:t,userId:n})},e.logout=function(){e.setState({token:null,userId:null})},e}return Object(c.a)(n,[{key:"render",value:function(){return i.a.createElement(m.a,null,i.a.createElement(h.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout}},i.a.createElement(j,null),i.a.createElement("main",{className:"main-content"},i.a.createElement(d.d,null,this.state.token&&i.a.createElement(d.a,{from:"/",to:"/events",exact:!0}),this.state.token&&i.a.createElement(d.a,{from:"/auth",to:"/events",exact:!0}),!this.state.token&&i.a.createElement(d.b,{path:"/auth",component:E}),i.a.createElement(d.b,{path:"/events",component:x}),this.state.token&&i.a.createElement(d.b,{path:"/bookings",component:N}),!this.state.token&&i.a.createElement(d.a,{to:"/auth",exact:!0})))))}}]),n}(a.Component));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(T,null)),document.getElementById("root"))}},[[24,1,2]]]);
//# sourceMappingURL=main.73b74e5f.chunk.js.map